# 🚀 部署执行计划

## 📊 当前状态

| 项目 | 状态 | 备注 |
|------|------|------|
| **代码仓库** | ✅ Gitee | https://gitee.com/spiritor/simplecal |
| **HTTP 服务** | ✅ 运行中 | localhost:8000（仅沙箱内可访问） |
| **游戏页面** | ✅ 就绪 | assets/math_game.html |
| **Vercel 配置** | ✅ 就绪 | vercel.json 已配置 |
| **环境变量** | ✅ 就绪 | .env.example 已配置 |

---

## 🎯 部署目标

1. **智能体部署到 Coze 平台**
   - 获得公网智能体链接
   - 支持对话交互

2. **游戏页面部署到 Vercel**
   - 获得公网游戏链接
   - 支持 HTTPS 访问

3. **集成测试**
   - 智能体启动游戏
   - 用户玩游戏
   - 提交结果给智能体
   - 智能体反馈评价

---

## 📋 部署步骤

### 阶段1：准备代码和配置 ✅

已完成：
- ✅ 代码推送到 Gitee
- ✅ Vercel 配置文件已创建
- ✅ 环境变量模板已创建
- ✅ 游戏页面已准备好

---

### 阶段2：部署游戏页面到 Vercel（第一步）

#### 为什么先部署游戏？
- 游戏链接需要配置到智能体中
- 先获得游戏链接，再部署智能体

#### 部署步骤

**选项 A：使用 Vercel Web 界面（推荐，最简单）**

1. **访问 Vercel**
   - 打开：https://vercel.com
   - 注册/登录账号（支持 GitHub、GitLab、Gitee）

2. **导入项目**
   - 点击 "Add New Project"
   - 点击 "Import Git Repository"
   - 选择 "Gitee"
   - 授权 Vercel 访问你的 Gitee 账号
   - 选择仓库：`spiritor/simplecal`

3. **配置项目**
   - Project Name: `simplecal-game`（或自定义）
   - Framework Preset: `Other`
   - Root Directory: `.`（根目录）
   - Build Command: 留空（静态文件不需要构建）
   - Output Directory: `assets`

4. **部署**
   - 点击 "Deploy"
   - 等待部署完成（约 1-2 分钟）
   - 记录返回的 URL，例如：`https://simplecal-game.vercel.app`

5. **获取游戏链接**
   游戏链接将是：
   ```
   https://simplecal-game.vercel.app/math_game.html
   ```

**选项 B：使用 Vercel CLI（适合开发者）**

```bash
# 1. 安装 Vercel CLI（在你的本地电脑）
npm install -g vercel

# 2. 登录 Vercel
vercel login

# 3. 部署项目
cd /workspace/projects
vercel

# 4. 按提示选择：
#    - Set up and deploy? Y
#    - Which scope? (选择你的账号)
#    - Link to existing project? N
#    - Project name? simplecal-game
#    - Build Command? (留空)
#    - Output Directory? assets

# 5. 记录返回的 URL
```

#### 预期结果

获得游戏公网链接，例如：
```
https://simplecal-game.vercel.app/math_game.html
```

---

### 阶段3：更新游戏链接配置

#### 方案 A：使用环境变量（推荐）

**1. 更新 game_interaction_tool.py**

修改 `src/tools/game_interaction_tool.py`：

```python
# 在文件开头的 import 部分添加
import os

# 修改 http_link 变量，使用环境变量
http_link = os.getenv("GAME_URL", "http://localhost:8080/game.html")
```

**2. 提交代码**

```bash
git add src/tools/game_interaction_tool.py
git commit -m "feat: 游戏链接支持环境变量配置"
git push origin main
```

#### 方案 B：直接硬编码链接（简单快速）

修改 `src/tools/game_interaction_tool.py`：

```python
# 将 http_link 修改为 Vercel 地址
http_link = "https://simplecal-game.vercel.app/math_game.html"
```

提交代码：
```bash
git add src/tools/game_interaction_tool.py
git commit -m "feat: 更新游戏链接为 Vercel 地址"
git push origin main
```

---

### 阶段4：部署智能体到 Coze 平台

#### 部署步骤

**1. 访问 Coze 平台**
   - 打开：https://www.coze.cn
   - 登录你的 Coze 账号

**2. 创建工作流**

有两种方式：

**方式 A：创建 Bot（推荐）**

1. 点击 "创建 Bot"
2. 选择 "自定义 Bot"
3. 填写 Bot 信息：
   - 名称：`简便运算智能体`
   - 描述：`小学三年级简便运算学习助手，提供智能讲解、练习出题和游戏闯关功能`
   - 头像：上传或选择一个数学相关的图标
4. 点击 "创建"

**方式 B：从 Git 导入（如果你有 Coze Enterprise）**

1. 点击 "创建工作流"
2. 选择 "从 Git 导入"
3. 输入仓库地址：`https://gitee.com/spiritor/simplecal.git`
4. 选择分支：`main`
5. 配置运行环境

**3. 配置环境变量**

在 Bot 设置或工作流配置中添加环境变量：

```bash
# API 密钥（从 Coze 平台获取）
COZE_WORKLOAD_IDENTITY_API_KEY=你的API密钥

# 模型服务地址
COZE_INTEGRATION_MODEL_BASE_URL=https://api.coze.com

# 游戏页面地址（使用你从 Vercel 获得的链接）
GAME_URL=https://simplecal-game.vercel.app/math_game.html

# 服务配置
PORT=8000
LOG_LEVEL=INFO
COZE_WORKSPACE_PATH=/workspace/projects
```

**4. 配置 Prompt**

将 `config/agent_llm_config.json` 中的 `sp` 字段内容复制到 Coze 的系统提示词配置中。

**5. 配置工具**

在 Coze 平台添加工具：
- MathProblemTool：数学题目生成与验证
- GameInteractionTool：游戏交互

**6. 发布**

- 点击 "发布"
- 等待部署完成
- 获取 Bot 访问链接

#### 预期结果

获得智能体公网链接，例如：
```
https://www.coze.cn/store/bot/your-bot-id
```

---

### 阶段5：集成测试

#### 测试清单

**1. 测试智能体对话**

访问 Coze 提供的智能体链接，测试：

- [ ] 发送"你好"，智能体正常响应
- [ ] 发送"讲解简便运算"，提供讲解
- [ ] 发送"出练习题"，生成题目
- [ ] 发送"开始游戏"，返回游戏链接

**2. 测试游戏页面**

在浏览器中打开游戏链接：

- [ ] 页面正常加载
- [ ] 可以选择难度
- [ ] 可以开始游戏
- [ ] 答题后可以提交
- [ ] 提交后可以查看结果

**3. 测试完整流程**

- [ ] 在智能体中说"开始游戏"
- [ ] 点击返回的游戏链接
- [ ] 选择难度并开始游戏
- [ ] 完成游戏并记录结果（分数、用时、答题数）
- [ ] 在智能体中说"提交游戏结果：得分80，用时2分钟"
- [ ] 智能体给出评价和建议

---

## 🎯 部署成功标志

部署成功后，你将获得：

### 1. 智能体链接
```
https://www.coze.cn/store/bot/your-bot-id
```
✅ 可以直接分享给同学
✅ 无需安装，浏览器打开即可使用

### 2. 游戏链接
```
https://simplecal-game.vercel.app/math_game.html
```
✅ 支持 HTTPS
✅ 全球 CDN 加速
✅ 移动端适配

### 3. 完整的学习体验
- 🎓 智能讲解
- 📝 练习出题
- 🎮 游戏闯关
- 📊 学习反馈

---

## 📝 部署记录模板

部署时请记录以下信息：

```
=== 部署记录 ===

日期：____年__月__日
操作人：__________

1. Vercel 部署
   - 项目名称：simplecal-game
   - 部署链接：https://simplecal-game.vercel.app
   - 游戏链接：https://simplecal-game.vercel.app/math_game.html
   - 部署时间：____:____

2. Coze 部署
   - Bot 名称：简便运算智能体
   - Bot ID：__________
   - 访问链接：https://www.coze.cn/store/bot/__________
   - 部署时间：____:____

3. 环境变量
   - GAME_URL：https://simplecal-game.vercel.app/math_game.html
   - COZE_WORKLOAD_IDENTITY_API_KEY：__________

4. 测试结果
   - 智能体对话：✅ / ❌
   - 游戏页面：✅ / ❌
   - 完整流程：✅ / ❌

5. 备注
   ________________
```

---

## 🔧 常见问题

### Q1: Vercel 部署失败？
**A:** 检查以下几点：
1. vercel.json 配置是否正确
2. 仓库是否公开
3. 是否授权了 Vercel 访问 Gitee

### Q2: Coze 导入 Git 失败？
**A:**
1. 确认仓库是公开的
2. 检查仓库 URL 是否正确
3. 使用 Coze 的自定义 Bot 功能代替

### Q3: 游戏链接打不开？
**A:**
1. 检查 Vercel 部署是否成功
2. 确认链接地址正确
3. 尝试访问根目录：`https://simplecal-game.vercel.app`

### Q4: 如何更新代码？
**A:**
```bash
# 修改代码
git add .
git commit -m "更新描述"
git push

# Vercel 会自动重新部署
# Coze 需要手动点击"重新部署"
```

---

## 📞 需要帮助？

如果在部署过程中遇到问题，告诉我：
1. **当前在哪一步？**
2. **遇到什么错误？**
3. **错误信息是什么？**

我会帮你解决！
